// This file is generated by kconfig_compiler from vpn.kcfg.
// All changes you do to this file will be lost.

#include <QDBusMetaType>

#include "vpndbus.h"
#include "vpn.h"

VpnDbus::VpnDbus(Knm::VpnSetting * setting) : SettingDbus(setting)
{
    qDBusRegisterMetaType<QStringMap>();
}

VpnDbus::~VpnDbus()
{
}

void VpnDbus::fromMap(const QVariantMap & map)
{
  Knm::VpnSetting * setting = static_cast<Knm::VpnSetting *>(m_setting);
  if (map.contains(QLatin1String(NM_SETTING_VPN_SERVICE_TYPE))) {
    setting->setServiceType(map.value(QLatin1String(NM_SETTING_VPN_SERVICE_TYPE)).value<QString>());
  }
  if (map.contains(QLatin1String(NM_SETTING_VPN_DATA))) {
    if (map.value(QLatin1String(NM_SETTING_VPN_DATA)).canConvert< QDBusArgument>()) {
      QDBusArgument dataArg = map.value(QLatin1String(NM_SETTING_VPN_DATA)).value<QDBusArgument>();
      setting->setData(qdbus_cast<QStringMap>(dataArg));
    } else {
      setting->setData(map.value(QLatin1String(NM_SETTING_VPN_DATA)).value<QStringMap>());
    }
  }
  if (map.contains(QLatin1String(NM_SETTING_VPN_USER_NAME))) {
    setting->setUserName(map.value(QLatin1String(NM_SETTING_VPN_USER_NAME)).value<QString>());
  }

  // SECRET
  if (map.contains(QLatin1String(NM_SETTING_VPN_SECRETS))) {
    if (map.value(QLatin1String(NM_SETTING_VPN_SECRETS)).canConvert< QDBusArgument>()) {
      QDBusArgument secretArg = map.value(QLatin1String(NM_SETTING_VPN_SECRETS)).value<QDBusArgument>();
      setting->setVpnSecrets(qdbus_cast<QStringMap>(secretArg));
    } else {
      setting->setVpnSecrets(map.value(QLatin1String(NM_SETTING_VPN_SECRETS)).value<QStringMap>());
    }
  }
}

QVariantMap VpnDbus::toMap()
{
  QVariantMap map;
  Knm::VpnSetting * setting = static_cast<Knm::VpnSetting *>(m_setting);

  map.insert(QLatin1String(NM_SETTING_VPN_SERVICE_TYPE), setting->serviceType());
  if (!setting->data().isEmpty())
      map.insert(QLatin1String(NM_SETTING_VPN_DATA), QVariant::fromValue(setting->data()));

  map.insert(QLatin1String(NM_SETTING_VPN_SECRETS), QVariant::fromValue(setting->vpnSecrets()));

  if (!setting->userName().isEmpty())
      map.insert(QLatin1String(NM_SETTING_VPN_USER_NAME), setting->userName());

  return map;
}

QVariantMap VpnDbus::toSecretsMap()
{
  Knm::VpnSetting * setting = static_cast<Knm::VpnSetting *>(m_setting);
  QVariantMap map;

  QMapIterator<QString, QString> i(setting->vpnSecrets());
  while (i.hasNext()) {
    i.next();
    map.insert(i.key(), i.value());
  }

  return map;
}

